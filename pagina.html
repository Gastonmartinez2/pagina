<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Alimentación Personalizada</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #4CAF50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        form {
            display: grid;
            gap: 20px;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        input, select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }

        button {
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        #results {
            margin-top: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        #results p {
            margin: 10px 0;
            font-size: 1.1em;
            color: #444;
        }

        #meal-options {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .group-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .group-section h2 {
            color: #4CAF50;
            font-size: 1.6em;
            margin-bottom: 15px;
        }

        .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .meal-option {
            flex: 1 1 300px;
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
            border: 1px solid #4CAF50;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }

        .meal-option:hover {
            box-shadow: 0 4px 15px rgba(76,175,80,0.3);
            transform: translateY(-5px);
        }

        .meal-option h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
            color: #4CAF50;
            text-align: center;
        }

        .meal-option ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .meal-option li {
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(76,175,80,0.1);
            border-radius: 5px;
            font-size: 1em;
            color: #333;
        }

        .meal-option li strong {
            color: #4CAF50;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2em;
            }
            .group-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>¡Tu Guía de Alimentación Personalizada!</h1>
        <form id="user-form">
            <label for="age">Edad (años):</label>
            <input type="number" id="age" min="10" max="60" required>

            <label for="sex">Sexo:</label>
            <select id="sex" required>
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
            </select>

            <label for="weight">Peso (kg):</label>
            <input type="number" id="weight" required>

            <label for="height">Talla (cm):</label>
            <input type="number" id="height" required>

            <label for="objective">Objetivo:</label>
            <select id="objective" required>
                <option value="muscle">Aumento de masa muscular</option>
                <option value="loss">Pérdida de grasa y descenso de peso</option>
                <option value="tone">Tonificar</option>
                <option value="maintain">Mantenimiento</option>
            </select>

            <label for="training-days">Días de entrenamiento por semana:</label>
            <input type="number" id="training-days" min="0" max="7" required>

            <label for="training-duration">Duración del entrenamiento (minutos por sesión):</label>
            <input type="number" id="training-duration" required>

            <label for="time-of-day">Momento del día para entrenamiento:</label>
            <select id="time-of-day">
                <option value="mañana">Mañana</option>
                <option value="tarde">Tarde</option>
                <option value="noche">Noche</option>
            </select>

            <label for="meals">Número de comidas al día:</label>
            <select id="meals">
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="walks">¿Realiza caminatas? (minutos por día):</label>
            <input type="number" id="walks" min="0" value="0" required>

            <button type="submit">Calcular Requerimientos</button>
        </form>

        <div id="results" style="display: none;">
            <h2>Resultados</h2>
            <p id="bmi"></p>
            <p id="calories"></p>
            <p id="proteins"></p>
            <p id="carbs"></p>
            <p id="fats"></p>
            <p id="fiber"></p>

            <h2>Selecciona una Comida</h2>
            <select id="meal-select">
                <option value="">--Selecciona--</option>
                <option value="desayuno">Desayuno</option>
                <option value="colacion">Colación (Snack Mañana)</option>
                <option value="almuerzo">Almuerzo</option>
                <option value="merienda">Merienda (Snack Tarde)</option>
                <option value="cena">Cena</option>
            </select>

            <div id="meal-options"></div>
        </div>
    </div>

    <script>
        // Base de datos de alimentos (macros por 100g)
        const foods = {
            // Lácteos
            'yogur entero': { hc: 12, prot: 4, fat: 2, fib: 0 },
            'yogur descremado': { hc: 6, prot: 4, fat: 0, fib: 0 },
            'leche parcial': { hc: 5, prot: 3, fat: 1, fib: 0 },
            'leche entera': { hc: 5, prot: 3, fat: 3, fib: 0 },
            'ricota': { hc: 4, prot: 12, fat: 12, fib: 0 },
            'queso crema': { hc: 4, prot: 7, fat: 23, fib: 0 },
            'queso semidescremado': { hc: 6, prot: 12, fat: 4, fib: 0 },
            'queso blanda': { hc: 2, prot: 21, fat: 22, fib: 0 },
            'queso semidura': { hc: 0, prot: 24, fat: 30, fib: 0 },
            'queso dura': { hc: 3, prot: 31, fat: 27, fib: 0 },
            'queso promedio': { hc: 3, prot: 22, fat: 21, fib: 0 },
            // Carnes y huevos
            'huevo': { hc: 0, prot: 12, fat: 12, fib: 0 },
            'cerdo': { hc: 0, prot: 20, fat: 19, fib: 0 },
            'vacuna': { hc: 0, prot: 20, fat: 10, fib: 0 },
            'ave': { hc: 0, prot: 21, fat: 4, fib: 0 },
            'pescado': { hc: 0, prot: 20, fat: 3, fib: 0 },
            'visceras': { hc: 3, prot: 17, fat: 14, fib: 0 },
            'mariscos': { hc: 0, prot: 18, fat: 1, fib: 0 },
            'carnes promedio': { hc: 0, prot: 21, fat: 6, fib: 0 },
            // Verduras, frutas, cereales
            'hortalizas a': { hc: 4, prot: 2, fat: 0, fib: 1.86 },
            'hortalizas b': { hc: 11, prot: 5, fat: 1, fib: 3.19 },
            'hortalizas c': { hc: 20, prot: 3, fat: 0, fib: 2.47 },
            'frutas': { hc: 13, prot: 1, fat: 0, fib: 2.15 },
            'cereales': { hc: 74, prot: 10, fat: 2, fib: 6.3 },
            'cereales integrales': { hc: 73, prot: 12, fat: 2, fib: 8.68 },
            'amasados': { hc: 49, prot: 8, fat: 9, fib: 3 },
            'legumbres': { hc: 61, prot: 22, fat: 3, fib: 18.23 },
            'soja': { hc: 30, prot: 36, fat: 20, fib: 9.3 },
            'milanesa soja': { hc: 40, prot: 29, fat: 15, fib: 2.92 },
            'pan': { hc: 52, prot: 8, fat: 2, fib: 2.63 },
            'pan salvado': { hc: 49, prot: 10, fat: 3, fib: 8.05 },
            // Galletitas, etc.
            'galletitas blanca': { hc: 62, prot: 14, fat: 16, fib: 2 },
            'galletitas integrales': { hc: 66, prot: 11, fat: 16, fib: 9.8 },
            'alfajor': { hc: 71, prot: 8, fat: 14, fib: 0.7 },
            'galletitas dulces': { hc: 72, prot: 5, fat: 20, fib: 1.5 },
            'copos cereales': { hc: 86, prot: 7, fat: 1, fib: 3.5 },
            'barras cereal': { hc: 73, prot: 4, fat: 8, fib: 2.1 },
            'quinua': { hc: 69, prot: 13, fat: 6, fib: 5.9 },
            'salvado avena': { hc: 66, prot: 17, fat: 7, fib: 15.4 },
            'frutas oleosas': { hc: 7, prot: 2, fat: 25, fib: 4.77 },
            'frutas secas': { hc: 20, prot: 19, fat: 54, fib: 9.3 }
        };

        // Opciones de comidas variadas, agrupadas para almuerzo y cena
        const mealOptions = {
            desayuno: [
                { protein: 'huevos', protPer100: 12, carb: 'avena', carbPer100: 66, desc: 'Huevos revueltos con avena.', veggie: 'una fruta mediana (ej. pera).' },
                { protein: 'yogur entero', protPer100: 4, carb: 'pan salvado', carbPer100: 49, desc: 'Yogur entero con pan salvado.', veggie: 'nueces (30g).' },
                { protein: 'queso cottage', protPer100: 12, carb: 'frutas', carbPer100: 13, desc: 'Queso cottage con frutas.', veggie: 'semillas (20g).' },
                { protein: 'yogur descremado', protPer100: 4, carb: 'copos cereales', carbPer100: 86, desc: 'Yogur descremado con copos de cereales.', veggie: 'bayas (100g).' },
                { protein: 'leche entera', protPer100: 3, carb: 'pan', carbPer100: 52, desc: 'Leche entera con pan.', veggie: 'queso (50g).' }
            ],
            colacion: [
                { protein: 'nueces', protPer100: 19, carb: 'manzana', carbPer100: 13, desc: 'Nueces con una manzana.', fixedProt: false },
                { protein: 'yogur entero', protPer100: 4, carb: 'bayas', carbPer100: 13, desc: 'Yogur con bayas frescas.', fixedProt: false },
                { protein: 'batido de proteina', protPer100: null, fixedProtAmount: 25, carb: 'plátano', carbPer100: 13, desc: 'Batido de proteína con plátano.', fixedProt: true },
                { protein: 'panqueques de proteina', protPer100: null, fixedProtAmount: 8, carb: 'frutas', carbPer100: 13, desc: 'Panqueques de proteína con frutas.', fixedProt: true },
                { protein: 'queso semidescremado', protPer100: 12, carb: 'galletitas integrales', carbPer100: 66, desc: 'Queso con galletitas integrales.', fixedProt: false }
            ],
            almuerzo: {
                'Carne Magra': [
                    { protein: 'carne magra', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Carne magra con arroz integral.', veggie: 'ensalada de tomate (100g de tomate).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Carne magra con papas al horno.', veggie: 'ensalada de lechuga (100g de lechuga).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Carne magra con fideos integrales.', veggie: 'brócoli (150g).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Carne magra con lentejas.', veggie: 'espinacas (100g).' }
                ],
                'Pescado': [
                    { protein: 'pescado', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Pescado a la plancha con arroz.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' },
                    { protein: 'pescado', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Pescado con papas.', veggie: 'zanahorias (150g).' },
                    { protein: 'pescado', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Pescado con fideos.', veggie: 'espárragos (150g).' },
                    { protein: 'pescado', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Pescado con lentejas.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' }
                ],
                'Pechuga de Pollo': [
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'arroz', carbPer100: 74, desc: 'Pechuga de pollo con arroz.', veggie: 'ensalada de tomate (100g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'papas', carbPer100: 20, desc: 'Pechuga de pollo con papas.', veggie: 'lechuga (100g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'fideos', carbPer100: 49, desc: 'Pechuga de pollo con fideos.', veggie: 'brócoli (150g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'lentejas', carbPer100: 61, desc: 'Pechuga de pollo con lentejas.', veggie: 'espinacas (100g).' }
                ],
                'Muslo de Pollo': [
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'arroz', carbPer100: 74, desc: 'Muslo de pollo con arroz.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'papas', carbPer100: 20, desc: 'Muslo de pollo con papas.', veggie: 'zanahorias (150g).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'fideos', carbPer100: 49, desc: 'Muslo de pollo con fideos.', veggie: 'espárragos (150g).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'lentejas', carbPer100: 61, desc: 'Muslo de pollo con lentejas.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' }
                ],
                'Carne de Cerdo': [
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Carne de cerdo magra con arroz.', veggie: 'brócoli (150g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Carne de cerdo con papas al horno.', veggie: 'espinacas (100g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Carne de cerdo con fideos.', veggie: 'zanahorias (150g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Carne de cerdo con lentejas.', veggie: 'ensalada de tomate (100g).' }
                ]
            },
            merienda: [
                { protein: 'queso crema', protPer100: 7, carb: 'galletitas', carbPer100: 62, desc: 'Queso crema con galletitas.', fixedProt: false },
                { protein: 'hummus', protPer100: 22, carb: 'zanahorias', carbPer100: 11, desc: 'Hummus con zanahorias.', fixedProt: false },
                { protein: 'batido de proteina', protPer100: null, fixedProtAmount: 25, carb: 'frutas', carbPer100: 13, desc: 'Batido proteico con frutas.', fixedProt: true },
                { protein: 'panqueques de proteina', protPer100: null, fixedProtAmount: 8, carb: 'bayas', carbPer100: 13, desc: 'Panqueques de proteína con bayas.', fixedProt: true },
                { protein: 'yogur entero', protPer100: 4, carb: 'barras cereal', carbPer100: 73, desc: 'Yogur con barra de cereal.', fixedProt: false }
            ],
            cena: {
                'Carne Magra': [
                    { protein: 'carne magra', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Carne magra con papas.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Carne magra con arroz.', veggie: 'lechuga (100g).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Carne magra con fideos.', veggie: 'tomate (100g).' },
                    { protein: 'carne magra', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Carne magra con lentejas.', veggie: 'brócoli (150g).' }
                ],
                'Pescado': [
                    { protein: 'pescado', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Pescado con fideos.', veggie: 'vegetales mixtos (zanahoria 50g, brócoli 50g - medio plato).' },
                    { protein: 'pescado', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Pescado con arroz.', veggie: 'espárragos (150g).' },
                    { protein: 'pescado', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Pescado con papas.', veggie: 'ensalada de tomate (100g).' },
                    { protein: 'pescado', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Pescado con lentejas.', veggie: 'espinacas (100g).' }
                ],
                'Pechuga de Pollo': [
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'lentejas', carbPer100: 61, desc: 'Pechuga de pollo con lentejas.', veggie: 'zanahorias (150g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'arroz', carbPer100: 74, desc: 'Pechuga de pollo con arroz.', veggie: 'tomate (100g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'papas', carbPer100: 20, desc: 'Pechuga de pollo con papas.', veggie: 'lechuga (100g).' },
                    { protein: 'pechuga de pollo', protPer100: 21, carb: 'fideos', carbPer100: 49, desc: 'Pechuga de pollo con fideos.', veggie: 'brócoli (150g).' }
                ],
                'Muslo de Pollo': [
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'arroz', carbPer100: 74, desc: 'Muslo de pollo con arroz integral.', veggie: 'espinacas (100g).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'papas', carbPer100: 20, desc: 'Muslo de pollo con papas.', veggie: 'tomate (100g).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'fideos', carbPer100: 49, desc: 'Muslo de pollo con fideos.', veggie: 'zanahorias (150g).' },
                    { protein: 'muslo de pollo', protPer100: 21, carb: 'lentejas', carbPer100: 61, desc: 'Muslo de pollo con lentejas.', veggie: 'ensalada mixta (lechuga 50g, tomate 50g, cebolla 50g - medio plato).' }
                ],
                'Carne de Cerdo': [
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'papas', carbPer100: 20, desc: 'Carne de cerdo con papas al horno.', veggie: 'brócoli (150g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'arroz', carbPer100: 74, desc: 'Carne de cerdo con arroz.', veggie: 'espinacas (100g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'fideos', carbPer100: 49, desc: 'Carne de cerdo con fideos.', veggie: 'lechuga (100g).' },
                    { protein: 'carne de cerdo', protPer100: 20, carb: 'lentejas', carbPer100: 61, desc: 'Carne de cerdo con lentejas.', veggie: 'tomate (100g).' }
                ]
            }
        };

        // Frutas variadas para ejemplos
        const fruits = ['pera', 'banana', 'naranja', 'kiwi', 'manzana'];

        // Fórmulas de cálculo
        function calculateBMI(weight, height) {
            height = height / 100;
            return (weight / (height * height)).toFixed(2);
        }

        function calculateBMR(weight, age, sex) {
            let bmr;
            if (age >= 10 && age < 18) {
                bmr = sex === 'male' ? 17.5 * weight + 651 : 12.2 * weight + 746;
            } else if (age >= 18 && age < 30) {
                bmr = sex === 'male' ? 15.3 * weight + 679 : 14.7 * weight + 496;
            } else if (age >= 30 && age <= 60) {
                bmr = sex === 'male' ? 11.6 * weight + 879 : 8.7 * weight + 829;
            } else {
                bmr = 1500; // Default
            }
            return bmr;
        }

        function calculateTDEE(bmr, hours) {
            let activityLevel = 1.2;
            if (hours >= 3 && hours < 5) activityLevel = 1.375;
            if (hours >= 5 && hours < 7) activityLevel = 1.55;
            if (hours >= 7) activityLevel = 1.725;
            return bmr * activityLevel;
        }

        function calculateMacros(tdee, weight, objective, meals, hours) {
            let protMin, protMax;
            switch (objective) {
                case 'muscle': protMin = 1.6; protMax = 2; break;
                case 'loss': protMin = 1.6; protMax = 1.8; break;
                case 'tone': protMin = 1.4; protMax = 1.8; break;
                case 'maintain': protMin = 1.2; protMax = 1.4; break;
            }
            const proteins = (((protMin + protMax) / 2) * weight).toFixed(0);

            let carbFactor = 3; // Base bajo
            if (hours >= 3 && hours < 5) carbFactor = 4.5;
            if (hours >= 5 && hours < 7) carbFactor = 5.5;
            if (hours >= 7 && hours < 14) carbFactor = 6.5;
            if (hours >= 14) carbFactor = 7;

            switch (objective) {
                case 'muscle': carbFactor *= 1.2; break;
                case 'loss': carbFactor *= 0.8; break;
                case 'tone': carbFactor *= 0.8; break;
                // maintain sin cambio
            }
            let carbs = (carbFactor * weight).toFixed(0);

            const fats = Math.max(0, (tdee - (proteins * 4) - (carbs * 4)) / 9).toFixed(0);
            let fiber = 30;
            if (objective === 'loss' || objective === 'tone') {
                fiber = 35; // Aumentar fibra para objetivos de pérdida/tonificación
            }

            return { proteins, carbs, fats, fiber };
        }

        // Manejo del formulario
        const form = document.getElementById('user-form');
        const results = document.getElementById('results');
        const mealSelect = document.getElementById('meal-select');
        const mealOptionsDiv = document.getElementById('meal-options');

        let dailyMacros = {};
        let numMeals = 4;
        let objective = 'maintain';

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const age = parseInt(document.getElementById('age').value);
            const sex = document.getElementById('sex').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            objective = document.getElementById('objective').value;
            const trainingDays = parseInt(document.getElementById('training-days').value);
            const trainingDuration = parseInt(document.getElementById('training-duration').value);
            const walks = parseInt(document.getElementById('walks').value);
            numMeals = parseInt(document.getElementById('meals').value);

            const weeklyTrainingHours = trainingDays * (trainingDuration / 60);
            const weeklyWalksHours = 7 * (walks / 60);
            const totalHours = weeklyTrainingHours + weeklyWalksHours;

            const bmi = calculateBMI(weight, height);
            const bmr = calculateBMR(weight, age, sex);
            const tdee = calculateTDEE(bmr, totalHours);
            dailyMacros = calculateMacros(tdee, weight, objective, numMeals, totalHours);

            document.getElementById('bmi').textContent = `IMC: ${bmi}`;
            document.getElementById('calories').textContent = `Calorías diarias estimadas: ${tdee.toFixed(0)} kcal`;
            document.getElementById('proteins').textContent = `Proteínas diarias: ${dailyMacros.proteins}g`;
            document.getElementById('carbs').textContent = `Carbohidratos diarios: ${dailyMacros.carbs}g`;
            document.getElementById('fats').textContent = `Grasas saludables diarias: ${dailyMacros.fats}g`;
            document.getElementById('fiber').textContent = `Fibra alimentaria diaria: ${dailyMacros.fiber}g`;

            results.style.display = 'block';
        });

        mealSelect.addEventListener('change', (e) => {
            const meal = e.target.value;
            mealOptionsDiv.innerHTML = '';
            if (meal && mealOptions[meal]) {
                let mealProteins = (dailyMacros.proteins / numMeals).toFixed(0);
                let mealCarbs = (dailyMacros.carbs / numMeals).toFixed(0);

                if (meal === 'cena' && (objective === 'loss' || objective === 'tone')) {
                    mealCarbs = (mealCarbs * 0.7).toFixed(0);
                }

                const options = mealOptions[meal];
                if (Array.isArray(options)) {
                    // Para comidas no agrupadas
                    options.forEach((option, index) => {
                        createMealOptionDiv(option, index, mealProteins, mealCarbs, mealOptionsDiv);
                    });
                } else {
                    // Para almuerzo y cena, agrupadas
                    Object.keys(options).forEach(group => {
                        const groupDiv = document.createElement('div');
                        groupDiv.classList.add('group-section');

                        const groupH2 = document.createElement('h2');
                        groupH2.textContent = group;
                        groupDiv.appendChild(groupH2);

                        const groupOptionsDiv = document.createElement('div');
                        groupOptionsDiv.classList.add('group-options');

                        options[group].forEach((option, index) => {
                            createMealOptionDiv(option, index, mealProteins, mealCarbs, groupOptionsDiv);
                        });

                        groupDiv.appendChild(groupOptionsDiv);
                        mealOptionsDiv.appendChild(groupDiv);
                    });
                }
            }
        });

        function createMealOptionDiv(option, index, mealProteins, mealCarbs, parentDiv) {
            const div = document.createElement('div');
            div.classList.add('meal-option');

            const h3 = document.createElement('h3');
            h3.textContent = `Opción ${index + 1}: ${option.desc}`;
            div.appendChild(h3);

            const ul = document.createElement('ul');

            let protLi = document.createElement('li');
            let protAmountText = '';
            if (option.fixedProt) {
                protAmountText = `1 porción de ${option.protein}`;
            } else {
                const amountProt = Math.round((mealProteins * 100) / option.protPer100);
                protAmountText = `${amountProt}g de ${option.protein} (peso crudo)`;
            }
            protLi.innerHTML = `<strong>Proteína:</strong> ${protAmountText}`;
            ul.appendChild(protLi);

            let carbLi = document.createElement('li');
            const amountCarb = Math.round((mealCarbs * 100) / option.carbPer100);
            carbLi.innerHTML = `<strong>Carbohidrato:</strong> ${amountCarb}g de ${option.carb} (peso crudo)`;
            ul.appendChild(carbLi);

            let addVeggie = option.veggie ? option.veggie.replace(/^y /, '') : '';
            let addFruit = '';
            let randomFruit = fruits[Math.floor(Math.random() * fruits.length)];

            if (objective === 'muscle') {
                // Solo veggie
                if (addVeggie) {
                    let fibLi = document.createElement('li');
                    fibLi.innerHTML = `<strong>Fibra:</strong> ${addVeggie}`;
                    ul.appendChild(fibLi);
                }
            } else if (objective === 'loss' || objective === 'tone') {
                // Veggie + fruit
                addFruit = `una fruta mediana como postre (ej. ${randomFruit}).`;
                if (addVeggie || addFruit) {
                    let fibLi = document.createElement('li');
                    fibLi.innerHTML = `<strong>Fibra:</strong> ${addVeggie} ${addFruit}`;
                    ul.appendChild(fibLi);
                }
            } else {
                // Mantenimiento: veggie
                if (addVeggie) {
                    let fibLi = document.createElement('li');
                    fibLi.innerHTML = `<strong>Fibra:</strong> ${addVeggie}`;
                    ul.appendChild(fibLi);
                }
            }

            div.appendChild(ul);
            parentDiv.appendChild(div);
        }
    </script>
</body>
</html>
